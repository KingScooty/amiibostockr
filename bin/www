#!/usr/bin/env node

/**
 * Module dependencies.
 */

var app = require('../app');
var debug = require('debug')('amiibotrackr:server');
var http = require('http');

/**
 * Get port from environment and store in Express.
 */

var port = normalizePort(process.env.PORT || '3000');
app.set('port', port);

/**
 * Create HTTP server.
 */

var server = http.createServer(app);

/**
 * Listen on provided port, on all network interfaces.
 */

server.listen(port);
server.on('error', onError);
server.on('listening', onListening);

/**
 * Normalize a port into a number, string, or false.
 */

function normalizePort(val) {
  var port = parseInt(val, 10);

  if (isNaN(port)) {
    // named pipe
    return val;
  }

  if (port >= 0) {
    // port number
    return port;
  }

  return false;
}

/**
 * Event listener for HTTP server "error" event.
 */

function onError(error) {
  if (error.syscall !== 'listen') {
    throw error;
  }

  var bind = typeof port === 'string'
    ? 'Pipe ' + port
    : 'Port ' + port;

  // handle specific listen errors with friendly messages
  switch (error.code) {
    case 'EACCES':
      console.error(bind + ' requires elevated privileges');
      process.exit(1);
      break;
    case 'EADDRINUSE':
      console.error(bind + ' is already in use');
      process.exit(1);
      break;
    default:
      throw error;
  }
}

/**
 * Event listener for HTTP server "listening" event.
 */

function onListening() {
  var addr = server.address();
  var bind = typeof addr === 'string'
    ? 'pipe ' + addr
    : 'port ' + addr.port;
  debug('Listening on ' + bind);
}


var amazon = require('amazon-product-api');

var client = amazon.createClient({
  awsId: process.env.AWSID,
  awsSecret: process.env.AWSSECRET
  awsTag: "kings0b-21"
});

// client.itemSearch({
//   keywords: 'Charizard Amiibo',
//   searchIndex: '',
//   responseGroup: 'ItemAttributes,Offers,Images',
//   domain: 'webservices.amazon.co.uk'
// })
//   .then(function(results){
//     console.log(results);
//   })

//   .catch(function(err){
//     console.log(err);
//   });

var util = require('util');

// console.log(util.inspect(myObject, {showHidden: false, depth: null}));

var UK_ids = [
  'B00Q6A57J2',
  'B00O9QCJFK',
  'B00SSU692M',
  'B00O9QC5N6',
  'B00N8PBOFO',
  'B00N8PBS0A',
  'B00Q6A571A',
  'B00QGBNLUI',
  'B00N8PBZSA',
  'B00N8PBQDE',
  'B00O9QC5R2',
  'B00Q6A578I',
  'B00SSU6936',
  'B00O9QC5Y0',
  'B00N8PBGV6',
  'B00N8PC142',
  'B00QGBNLU8',
  'B00QGBNMW0',
  'B00SSU6940',
  'B00SSU69DG',
  'B00N8PBJQ8',
  'B00N8PBYK4',
  'B00O9QCHDO',
  'B00SSU693Q',
  'B00Q6A56C0',
  'B00N8PBTVS',
  'B00Q6A56DY',
  'B00QGBNLUS',
  'B00QGBNLTO',
  'B00Q6A57C4',
  'B00N8PBXFK',
  'B00SSU65QC',
  'B00N8PBVHU',
  'B00N8PBMK6',
  'B00O9QC5PY'
]

var US_ids = [
  'B00PG6Z65M',
  'B00O97ZVJ0',
  'B00V86BJX2',
  'B00O982JSU',
  'B00N4ABP7A',
  'B00N4ABODK',
  'B00PG7M95G',
  'B00PG6ZDPK',
  'B00N4ABV10',
  'B00N4ABVOM',
  'B00O97ZVJA',
  'B00V86BJV4',
  'B00O97ZWVC',
  'B00N4ABMG4',
  'B00N4ABOXU',
  'B00PG6ZCT2',
  'B00V86BRK2',
  'B00N4ABT1W',
  'B00N4ABSLS',
  'B00O97ZYP6',
  'B00V86BRHU',
  'B00N49EEO2',
  'B00PG6ZAZ8',
  'B00PG6ZBTS',
  'B00PG6Z9VI',
  'B00N4ABMUA',
  'B00V86C4LS',
  'B00N49EERY',
  'B00N4ABT1C',
  'B00O92ONBM'
]

client.itemLookup({
  idType: 'ASIN',
  // itemId: 'B00TS0UFAS',
  Condition: 'New',
  includeReviewsSummary: false,
  itemId: 'B00N4ABMUA',
  responseGroup: 'ItemAttributes,Offers,Images',
  // MerchantId: 'Amazon',
  domain: 'webservices.amazon.com'
}, function(err, results) {
  if (err) {
    // console.log(err);
    console.log(util.inspect(err, false, null));
  } else {
    console.log(util.inspect(results, false, null));
    // console.log(results);
  }
});
